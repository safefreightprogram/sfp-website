<!DOCTYPE html>
<html lang="en-AU">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Subscribe to Safe Freight Intel – Safe Freight Program</title>
<!-- Updated Favicons -->
<link rel="apple-touch-icon" sizes="180x180" href="/public/apple-touch-icon.png?v=2">
<link rel="icon" type="image/png" sizes="32x32" href="/public/favicon-32x32.png?v=2">
<link rel="icon" type="image/png" sizes="16x16" href="/public/favicon-16x16.png?v=2">
<link rel="manifest" href="/public/site.webmanifest?v=2">
<link rel="mask-icon" href="/public/safari-pinned-tab.svg?v=2" color="#1e40af">
<meta name="msapplication-TileColor" content="#1e40af">
<meta name="theme-color" content="#ffffff">

  <script src="https://cdn.tailwindcss.com"></script>

  <meta name="description" content="Stay informed with CoR Intel Weekly for professionals and Safe Freight Mate for drivers. Up to date analysis of regulatory changes, enforcement trends, and industry developments." />
  <meta property="og:title" content="Safe Freight Intel Newsletter" />
  <meta property="og:description" content="Professional compliance intelligence for Australia's freight industry" />

  <style>
    @keyframes fadeInUp { 0% { opacity: 0; transform: translateY(20px);} 100% { opacity: 1; transform: translateY(0);} }
    .animate-fadeInUp { animation: fadeInUp 0.6s ease-out both; }
    .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }

    /* --- Header/logo hard caps to stop giant logos leaking in from partials --- */
    #site-header img, #site-header svg, #header-placeholder img, #header-placeholder svg {
      max-height: 40px; width: auto; height: auto;
    }
    /* Ensure any raw images in the header don’t expand the layout */
    #site-header, #header-placeholder { overflow: hidden; }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans">

  <!-- Tailwind CDN safelist: ensure injected header/footer utilities exist on iOS WebKit -->
  <div class="hidden" aria-hidden="true">
    <!-- Header base -->
    <div class="bg-blue-900 bg-blue-800 bg-blue-700 text-white sticky top-0 z-50 shadow shadow-sm border-b border-gray-200"></div>
    <div class="relative max-w-7xl mx-auto px-4 h-14 flex items-center justify-between overflow-hidden"></div>

    <!-- Logo/title -->
    <div class="flex items-center gap-3 transition-transform hover:scale-[1.05]"></div>
    <img class="h-9 max-h-9 w-auto block" alt="">
    <div class="absolute inset-0 flex items-center justify-center pointer-events-none"></div>
    <div class="hidden sm:block text-base sm:text-lg font-semibold opacity-95"></div>

    <!-- Right-side controls -->
    <div class="flex items-center gap-2"></div>
    <div class="inline-flex items-center justify-center min-h-9 min-w-9"></div>
    <button class="p-2 h-9 w-9 inline-flex items-center justify-center rounded-md hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/30"></button>
    <svg class="h-5 w-5 h-6 w-6"></svg>

    <!-- Details dropdown primitives -->
    <details class="relative inline-block"></details>
    <summary class="list-none cursor-pointer"></summary>
    <summary class="list-none inline-flex items-center justify-center h-9 w-9 rounded-md hover:bg-white/10 cursor-pointer"></summary>

    <!-- Search dropdown -->
    <div class="absolute right-0 mt-2 w-80 max-w-[90vw] rounded-lg border border-white/10 bg-blue-900/95 backdrop-blur p-2 shadow-lg"></div>
    <input class="w-full rounded-md px-3 py-2 text-sm text-gray-900" />

    <!-- Hamburger/menu dropdown -->
    <div class="absolute right-0 mt-2 w-72 rounded-lg border border-white/10 bg-blue-900/95 shadow-lg overflow-hidden"></div>
    <div class="py-2"></div>
    <a class="block px-4 py-2 text-sm text-white hover:bg-white/10"></a>
    <div class="border-t border-white/10 mt-2"></div>

    <!-- Mobile menu panel (if used) -->
    <div class="md:hidden"></div>
    <div class="fixed inset-0 bg-black/20"></div>
    <div class="fixed right-0 top-0 h-full w-72 bg-blue-900 text-white shadow-lg"></div>
  </div>

  <!-- Header placeholder (for partial injection) -->
  <div id="header-placeholder"></div>

  <!-- Minimal header fallback (shown only if partial load fails) -->
  <header id="site-header" class="hidden bg-white border-b">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <a href="/" class="flex items-center gap-3">
        <img src="/assets/sfp-logo-small.png" alt="Safe Freight Program" class="h-8 w-auto">
        <span class="sr-only">Safe Freight Program</span>
      </a>
      <nav class="text-sm">
        <a href="/subscribe.html" class="text-blue-700 font-semibold">Subscribe</a>
      </nav>
    </div>
  </header>

 <main class="max-w-4xl mx-auto px-4 py-6">

  <!-- Compact Infrastructure Header -->
  <section class="mb-8">
    <p class="text-xs font-semibold tracking-wider text-gray-500 uppercase mb-2">
      Newsletter
    </p>

    <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-2">
      Safe Freight Intel
    </h1>

    <p class="text-gray-600 max-w-2xl">
      Weekly regulatory intelligence for professionals and drivers across Australia’s freight industry.
    </p>
  </section>

  <!-- Subscription Form Card -->
  <section class="max-w-2xl">
    <div class="bg-white rounded-2xl border border-gray-200 p-6 shadow-sm">

        <h2 class="text-lg font-semibold text-gray-900 mb-6">
          Subscribe
        </h2>

  <div id="footer-placeholder"></div>

  <!-- Header/footer loader & account indicator -->
  <script src="/js/load-header-footer.js" defer></script>
  <script src="/js/account-indicator.js" defer></script>

<script>

// Handle error messages from URL parameters
window.addEventListener('DOMContentLoaded', function() {
  const urlParams = new URLSearchParams(window.location.search);
  const error = urlParams.get('error');

  if (error) {
    const errorDiv = document.createElement('div');
    errorDiv.className = 'bg-red-50 border border-red-200 rounded-lg p-4 mb-6';
    errorDiv.innerHTML = `
      <div class="flex">
        <svg class="w-5 h-5 text-red-600 mr-3 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <p class="text-red-700">${decodeURIComponent(error)}</p>
      </div>
    `;
    const form = document.getElementById('newsletter-form');
    if (form && form.parentNode) form.parentNode.insertBefore(errorDiv, form);
  }

  // Real-time validation: hide segment error once any box is checked
  document.querySelectorAll('input[name="segments[]"]').forEach(function(cb) {
    cb.addEventListener('change', function() {
      if (document.querySelectorAll('input[name="segments[]"]:checked').length > 0) {
        document.getElementById('segment-error').classList.add('hidden');
      }
    });
  });
});
</script>
<script>
document.addEventListener('DOMContentLoaded', function () {
  const form = document.getElementById('newsletter-form');
  if (!form) return;

  const btn = document.getElementById('submit-btn');
  const msgBox = document.getElementById('form-messages');

const API_BASE_URL = window.location.hostname === 'localhost'
  ? 'http://localhost:3000'
  : 'https://sfp-newsletter-automation-production.up.railway.app';

  function showMessage(type, text) {
    if (!msgBox) return;
    msgBox.className = 'mt-4 rounded-lg p-4 ' +
      (type === 'error'
        ? 'bg-red-50 border border-red-200 text-red-800'
        : 'bg-green-50 border border-green-200 text-green-800');
    msgBox.textContent = text;
    msgBox.classList.remove('hidden');
  }

  function lockBtn() {
    if (!btn) return;
    btn.disabled = true;
    btn.textContent = 'Submitting…';
  }

  function unlockBtn() {
    if (!btn) return;
    btn.disabled = false;
    btn.textContent = 'Subscribe Now';
  }

  form.addEventListener('submit', async function (e) {
    e.preventDefault();

    const checked = document.querySelectorAll('input[name="segments[]"]:checked');
    if (checked.length === 0) {
      const el = document.getElementById('segment-error');
      if (el) el.classList.remove('hidden');
      return;
    }

    const email = document.getElementById('email')?.value?.trim();
    const name = document.getElementById('name')?.value?.trim();
    const company = document.getElementById('company')?.value?.trim();
    const role = document.getElementById('role')?.value;
    const consent = document.getElementById('consent')?.checked;
const segments = Array.from(checked).map(el => el.value);
    if (!email) {
      showMessage('error', 'Email is required.');
      return;
    }

    if (!consent) {
      showMessage('error', 'Consent is required.');
      return;
    }

    lockBtn();

    try {
      const response = await fetch(`${API_BASE_URL}/api/subscribers`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, name, company, role, segments })
      });

      const data = await response.json().catch(() => ({}));

      if (!response.ok) {
        showMessage('error', data.error || 'Subscription failed.');
        unlockBtn();
        return;
      }

      const msg = (data.message || '').toString().trim();
const serverSegments = (data.data && data.data.segments) ? String(data.data.segments) : segments.join(',');

// New signup (double opt-in) -> pending page
if (msg === 'Subscriber created (pending) — confirmation email sent') {
  window.location.href =
    `/subscribe-pending.html?email=${encodeURIComponent(email)}&segments=${encodeURIComponent(segments.join(','))}`;
} else {
  // Existing subscriber: segment added / already subscribed / reactivated -> confirmed page
  // mode values: updated | already | reactivated
  let mode = 'updated';
  if (msg === 'Subscriber already subscribed to selected list(s)') mode = 'already';
  if (msg === 'Subscription reactivated successfully') mode = 'reactivated';

  window.location.href =
    `/subscribe-confirmed.html?email=${encodeURIComponent(email)}&segments=${encodeURIComponent(serverSegments)}&mode=${encodeURIComponent(mode)}`;
}

    } catch (err) {
      showMessage('error', 'Network error. Please try again.');
      unlockBtn();
    }
  });
});
</script>

  
</body>
</html>
