<!DOCTYPE html>
<html lang="en-AU">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Find an Authorised Inspection Location (AIL)</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
</head>
<body class="bg-gray-50 text-gray-800 font-sans">

  <!-- Top Nav -->
  <header class="bg-blue-900 text-white px-6 py-4 text-xl font-bold">
    Find an Authorised Inspection Location (AIL)
  </header>

  <!-- Main Content -->
  <main class="p-6">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <!-- List -->
      <div class="md:col-span-2 space-y-2" id="ail-list">
        <!-- AIL cards will be inserted here -->
      </div>

      <!-- Map -->
      <div class="bg-white shadow rounded h-[600px]" id="map"></div>
    </div>
  </main>

  <!-- Map Script + AIL Loader -->
  <script>
    let map;

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: -25.2744, lng: 133.7751 },
        zoom: 4,
      });

      fetch('data/ail-locations.json')
        .then(response => response.json())
        .then(data => {
          const list = document.getElementById('ail-list');
          data.forEach(ail => {
            // Add to list
            const card = document.createElement('div');
            card.className = 'bg-white p-4 rounded shadow';
            card.innerHTML = `
              <h2 class="font-bold text-lg">${ail.Company}</h2>
              <p>${ail['Business Address Line 1']}, ${ail.Suburb} ${ail.State} ${ail.Postcode}</p>
              <p><strong>Phone:</strong> ${ail.Phone || 'N/A'}</p>
              <p><strong>Inspector:</strong> ${ail['Licensed Inspector'] || 'N/A'}</p>
            `;
            list.appendChild(card);

            // Add to map
            if (ail.Latitude && ail.Longitude) {
              const marker = new google.maps.Marker({
                position: { lat: parseFloat(ail.Latitude), lng: parseFloat(ail.Longitude) },
                map: map,
                title: ail.Company,
              });

              const infowindow = new google.maps.InfoWindow({
                content: `<strong>${ail.Company}</strong><br>${ail['Business Address Line 1']}<br>${ail.Suburb} ${ail.State} ${ail.Postcode}`,
              });

              marker.addListener('click', () => {
                infowindow.open(map, marker);
              });
            }
          });
        })
        .catch(error => {
          console.error("Failed to load AIL data:", error);
        });
    }
  </script>

  <!-- Google Maps API -->
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAWEYToL4z29KXAMpurP87nV22o4hiIIms&callback=initMap">
  </script>
</body>
</html>
