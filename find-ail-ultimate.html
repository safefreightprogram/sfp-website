<!DOCTYPE html>
<html lang="en-AU">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Find an AIL â€“ Safe Freight Program</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  
  <style>
    #map {
      width: 100%;
      height: 500px;
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans">

  <!-- Header with Navigation -->
  <header class="bg-blue-900 text-white sticky top-0 z-50 shadow" x-data="{ open: false, showSearch: false }">
    <div class="max-w-7xl mx-auto p-4 flex justify-between items-center relative">
      <div class="flex items-center space-x-3">
        <a href="index.html" class="transition-transform transform hover:scale-[1.05]">
          <img src="SFP-Logo.png" alt="Safe Freight Program" class="h-8 w-auto">
        </a>
      </div>
      
      <!-- Controls -->
      <div class="flex items-center space-x-4">
        <button @click="showSearch = !showSearch" class="inline-flex transition-transform transform hover:scale-105">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35m1.35-4.65a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
        </button>
        
        <button @click="open = !open" class="inline-flex transition-transform transform hover:scale-105">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>
      
      <!-- Search bar -->
      <div x-show="showSearch" @click.away="showSearch = false" x-transition 
           class="absolute top-full right-0 bg-blue-900 shadow-md z-40 w-full sm:w-80 md:w-72 lg:w-64">
        <div class="p-4">
          <form action="search.html" method="GET">
            <input type="search" name="q" placeholder="Type a word"
                   class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:ring-blue-500 text-black">
          </form>
        </div>
      </div>
      
      <!-- Navigation menu -->
      <div x-show="open" @click.away="open = false" x-transition 
           class="absolute top-full right-0 bg-blue-900 text-white text-sm z-50 shadow-md"
           :class="showSearch ? 'mt-16 sm:mt-0 sm:right-80 md:right-72 lg:right-64' : ''">
        <nav class="flex flex-col">
          <a href="about.html" class="block px-4 py-2 hover:bg-blue-800">About</a>
          <a href="lookup-driver.html" class="block px-4 py-2 hover:bg-blue-800">Driver Lookup</a>
          <a href="lookup-vehicle.html" class="block px-4 py-2 hover:bg-blue-800">Vehicle Lookup</a>
          <a href="find-ail.html" class="block px-4 py-2 hover:bg-blue-800 bg-blue-800">Find AIL</a>
          <a href="training.html" class="block px-4 py-2 hover:bg-blue-800">SFP Training</a>
          <a href="ail-login.html" class="block px-4 py-2 hover:bg-blue-800">AIL Portal</a>
          <a href="trainer-login.html" class="block px-4 py-2 hover:bg-blue-800">Trainer Login</a>
          <a href="contact.html" class="block px-4 py-2 hover:bg-blue-800">Contact</a>
          <a href="subscription.html" class="block px-4 py-2 hover:bg-blue-800">Subscribe</a>
        </nav>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 py-8" x-data="{ 
    activeTab: 'map',
    selectedState: 'all', 
    searchText: '',
    filteredLocations: [],
    
    init() {
      this.filteredLocations = ailData;
    },
    
    filterLocations() {
      this.filteredLocations = ailData.filter(location => {
        const matchesSearch = !this.searchText || location.company.toLowerCase().includes(this.searchText.toLowerCase());
        const matchesState = this.selectedState === 'all' || location.state === this.selectedState;
        return matchesSearch && matchesState;
      });
      if (this.activeTab === 'map' && typeof filterMapMarkers === 'function') {
        filterMapMarkers();
      }
    }
  }">

    <!-- Page Header -->
    <div class="text-center mb-8">
      <h1 class="text-3xl md:text-4xl font-bold text-blue-800 mb-4">Find an Authorised Inspection Location</h1>
      <p class="text-lg text-gray-600">Search for Safe Freight Program AIL locations across Australia</p>
    </div>

    <!-- Search Filters -->
    <div class="bg-white rounded-lg shadow p-6 mb-6">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <!-- Search Text -->
        <div class="md:col-span-2">
          <label class="block text-sm font-medium text-gray-700 mb-2">Search by Company Name</label>
          <input 
            type="text" 
            x-model="searchText"
            @input="filterLocations()"
            placeholder="Enter company name..."
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
        </div>

        <!-- State Filter -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">State</label>
          <select 
            x-model="selectedState"
            @change="filterLocations()"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
            <option value="all">All States</option>
            <option value="NSW">NSW</option>
            <option value="QLD">QLD</option>
            <option value="VIC">VIC</option>
            <option value="SA">SA</option>
            <option value="WA">WA</option>
            <option value="NT">NT</option>
            <option value="TAS">TAS</option>
          </select>
        </div>

        <!-- Clear Button -->
        <div class="flex items-end">
          <button 
            @click="searchText = ''; selectedState = 'all'; filterLocations()"
            class="w-full bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-md transition-colors"
          >
            Clear
          </button>
        </div>
      </div>

      <!-- Results Count -->
      <div class="mt-4 text-sm text-gray-600">
        Showing <strong x-text="filteredLocations.length"></strong> of <strong>67</strong> locations
      </div>
    </div>

    <!-- Tab Navigation -->
    <div class="bg-white rounded-lg shadow overflow-hidden">
      <div class="border-b border-gray-200">
        <nav class="flex">
          <button 
            @click="activeTab = 'map'; if(window.google && window.map) { setTimeout(() => { google.maps.event.trigger(map, 'resize'); map.setCenter({ lat: -25.2744, lng: 133.7751 }); }, 100); }"
            :class="activeTab === 'map' ? 'bg-blue-600 text-white' : 'bg-gray-50 text-gray-700 hover:text-gray-900'"
            class="px-6 py-3 font-medium text-sm"
          >
            Map View
          </button>
          <button 
            @click="activeTab = 'list'"
            :class="activeTab === 'list' ? 'bg-blue-600 text-white' : 'bg-gray-50 text-gray-700 hover:text-gray-900'"
            class="px-6 py-3 font-medium text-sm"
          >
            List View
          </button>
        </nav>
      </div>

      <!-- Tab Content -->
      <div class="p-0">
        
        <!-- Map View -->
        <div x-show="activeTab === 'map'">
          <div id="map"></div>
        </div>

        <!-- List View -->
        <div x-show="activeTab === 'list'" class="p-6">
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <template x-for="location in filteredLocations" :key="location.id">
              <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                <div class="flex justify-between items-start mb-2">
                  <h3 class="font-semibold text-gray-800 text-sm" x-text="location.company"></h3>
                  <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded" x-text="location.state"></span>
                </div>
                
                <p class="text-gray-600 text-sm mb-3" x-text="location.address"></p>
                
                <div class="flex items-center justify-between">
                  <a :href="'tel:' + location.phone" class="text-blue-600 hover:text-blue-800 text-sm font-medium" x-text="location.phone"></a>
                  <button class="bg-blue-600 hover:bg-blue-700 text-white text-xs px-3 py-1 rounded transition-colors">
                    Directions
                  </button>
                </div>
              </div>
            </template>
          </div>
          
          <!-- No results -->
          <div x-show="filteredLocations.length === 0" class="text-center py-12">
            <p class="text-gray-500">No locations found. Try adjusting your search criteria.</p>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-100 border-t border-gray-200 text-sm text-center text-gray-600 p-4 mt-16">
    &copy; 2025 Safe Freight Program. All rights reserved.
  </footer>

  <!-- Load Google Maps -->
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAPnUqhxYzzgoRJ32Rh6-bg5wmKuXtBmKI&callback=initMap&libraries=geometry">
  </script>

  <script>
    let map;
    let markers = [];
    let ailData = [];

    // Sample AIL data
    const rawAilData = [
      {id: 239, company: "Aero Refuellers", address: "Hanger 8-11 Ogden Street, East Albury NSW 2640", phone: "02 6041 1599", lat: -36.071665, lng: 146.9537581, state: "NSW"},
      {id: 222, company: "Australian Fuelling Systems & Equip", address: "7-11 Armstrong Street, Tamworth NSW 2340", phone: "02 6760 7816", lat: -31.0791106, lng: 150.8532199, state: "NSW"},
      {id: 220, company: "Doug Sutherland Truck Repairs", address: "222 Urana Street, Wagga Wagga NSW 2650", phone: "02 6925 2094", lat: -35.1252742, lng: 147.3413631, state: "NSW"},
      {id: 410, company: "Brown & Hurley", address: "2 Central Park Drive, South Mackay QLD 4740", phone: "07 4952 3722", lat: -21.1755649, lng: 149.1661223, state: "QLD"},
      {id: 452, company: "CQ Diesel Fitting", address: "23 Bensted Road, Gladstone QLD 4680", phone: "07 4972 7401", lat: -23.8584217, lng: 151.229545, state: "QLD"},
      {id: 305, company: "Acme Oil Equipment Services Pty Ltd", address: "32 Greens Road, Dandenong South VIC 3175", phone: "03 9791 3255", lat: -38.015738, lng: 145.2209347, state: "VIC"},
      {id: 320, company: "Australian Tank Engineering", address: "29-31 Vella Drive, Sunshine VIC 3020", phone: "03 9310 2722", lat: -37.8056095, lng: 144.828958, state: "VIC"},
      {id: 503, company: "Haulmark Trailers Australia", address: "97-99 West Avenue, Edinburgh SA 5111", phone: "08 8283 8585", lat: -34.7327779, lng: 138.6344371, state: "SA"},
      {id: 657, company: "Fuel Maintenance and Engineering", address: "1562 Arthur Road, Geraldton WA 6530", phone: "0409 981 026", lat: -28.8346566, lng: 114.7321136, state: "WA"},
      {id: 820, company: "Haulmark Trailers Australia", address: "1 Mettham Road, Berrimah NT 828", phone: "08 8984 3533", lat: -12.4606551, lng: 130.9283392, state: "NT"},
      {id: 704, company: "AJL Heavy Equipment", address: "1-3 Massy-Greene Drive, South Burnie TAS 7320", phone: "03 6430 2777", lat: -41.0674275, lng: 145.9239546, state: "TAS"}
    ];

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        zoom: 5,
        center: { lat: -25.2744, lng: 133.7751 }
      });

      ailData = rawAilData;
      loadMarkers();
    }

    function loadMarkers() {
      markers.forEach(marker => marker.setMap(null));
      markers = [];

      ailData.forEach(ail => {
        const marker = new google.maps.Marker({
          position: { lat: ail.lat, lng: ail.lng },
          map: map,
          title: ail.company
        });

        const infoWindow = new google.maps.InfoWindow({
          content: `
            <div>
              <h3><strong>${ail.company}</strong></h3>
              <p>${ail.address}</p>
              <p><a href="tel:${ail.phone}">${ail.phone}</a></p>
            </div>
          `
        });

        marker.addListener("click", () => {
          infoWindow.open(map, marker);
        });

        markers.push(marker);
      });
    }

    function filterMapMarkers() {
      const activeFilters = document.querySelector('[x-data]').__x.$data;
      
      markers.forEach(marker => {
        const ail = ailData.find(a => a.lat === marker.getPosition().lat() && a.lng === marker.getPosition().lng());
        if (ail) {
          const matchesSearch = !activeFilters.searchText || ail.company.toLowerCase().includes(activeFilters.searchText.toLowerCase());
          const matchesState = activeFilters.selectedState === 'all' || ail.state === activeFilters.selectedState;
          
          marker.setVisible(matchesSearch && matchesState);
        }
      });
    }

    window.initMap = initMap;
  </script>
</body>
</html>
