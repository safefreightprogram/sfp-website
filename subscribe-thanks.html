<!doctype html>
<html lang="en-AU">
<head>
  <meta charset="utf-8">
  <title>Thanks â€“ Safe Freight Program</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Updated Favicons -->
  <link rel="apple-touch-icon" sizes="180x180" href="/public/apple-touch-icon.png?v=2">
  <link rel="icon" type="image/png" sizes="32x32" href="/public/favicon-32x32.png?v=2">
  <link rel="icon" type="image/png" sizes="16x16" href="/public/favicon-16x16.png?v=2">
  <link rel="manifest" href="/public/site.webmanifest?v=2">
  <link rel="mask-icon" href="/public/safari-pinned-tab.svg?v=2" color="#1e40af">
  <meta name="msapplication-TileColor" content="#1e40af">
  <meta name="theme-color" content="#ffffff">

  <script src="https://cdn.tailwindcss.com"></script>
  
  <style>
    @keyframes fadeInUp { 
      0% { opacity: 0; transform: translateY(20px); } 
      100% { opacity: 1; transform: translateY(0); } 
    }
    .animate-fadeInUp { animation: fadeInUp 0.6s ease-out both; }
    
    @keyframes pulse { 
      0%, 100% { opacity: 1; } 
      50% { opacity: .7; } 
    }
    .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">
  <main class="max-w-2xl mx-auto px-4 py-16">
    <div class="bg-white rounded-lg shadow-lg p-8 text-center animate-fadeInUp">
      <!-- Success Icon -->
      <div class="bg-green-100 p-4 rounded-full w-20 h-20 mx-auto mb-6 flex items-center justify-center">
        <svg class="w-10 h-10 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
        </svg>
      </div>

      <h1 class="text-3xl font-bold text-blue-800 mb-4">Almost there!</h1>
      
      <p class="text-lg text-gray-700 mb-6">
        We've sent a confirmation email to complete your subscription to Safe Freight Intel.
      </p>
      
      <!-- Email Check Reminder -->
      <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6 mb-6">
        <div class="flex items-center justify-center mb-3">
          <svg class="w-6 h-6 text-yellow-600 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z" />
          </svg>
          <h3 class="text-lg font-semibold text-yellow-800">Check Your Email</h3>
        </div>
        <p class="text-yellow-700 text-sm">
          <strong>Don't see our email?</strong> Please check your <strong>Junk</strong>, <strong>Spam</strong>, or <strong>Promotions</strong> folder. 
          Sometimes our emails end up there by mistake.
        </p>
      </div>

      <!-- Next Steps -->
      <div class="text-left bg-blue-50 rounded-lg p-6 mb-6">
        <h3 class="text-lg font-semibold text-blue-800 mb-3">What happens next:</h3>
        <ol class="space-y-2 text-gray-700">
          <li class="flex items-center">
            <span class="bg-blue-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-semibold mr-3">1</span>
            Check your email and click the confirmation link
          </li>
          <li class="flex items-center">
            <span class="bg-blue-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-semibold mr-3">2</span>
            You'll automatically receive the latest newsletter editions
          </li>
          <li class="flex items-center">
            <span class="bg-blue-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-semibold mr-3">3</span>
            Stay informed with weekly compliance intelligence
          </li>
        </ol>
      </div>

      <!-- Resend Link -->
      <div class="text-sm text-gray-600 mb-6">
        <p>Didn't receive the email? <a href="#" id="resend-link" class="text-blue-600 hover:underline">Click here to resend</a></p>
        <div id="resend-message" class="hidden text-green-600 mt-2">Confirmation email sent!</div>
      </div>

      <!-- Action Buttons -->
      <div class="space-y-3">
        <a href="/" class="inline-block bg-blue-700 text-white px-8 py-3 rounded-lg font-semibold hover:bg-blue-800 transition-colors">
          Back to Home
        </a>
        <div>
          <a href="/subscribe.html" class="text-blue-600 hover:underline text-sm">
            Subscribe a different email address
          </a>
        </div>
      </div>
    </div>

    <!-- Additional Help -->
    <div class="mt-8 text-center text-gray-600">
      <p class="text-sm">
        Need help? Contact us at 
        <a href="mailto:support@safefreightprogram.com" class="text-blue-600 hover:underline">support@safefreightprogram.com</a>
      </p>
    </div>
  </main>

  <script>
// Get URL parameters
const urlParams = new URLSearchParams(window.location.search);
const email = urlParams.get('email');
const segments = urlParams.get('segments') ? urlParams.get('segments').split(',') : [];

// Update the page content based on subscribed segments
document.addEventListener('DOMContentLoaded', function() {
  updateThankYouContent();
  
  // Handle resend confirmation email (seamless, no banner)
document.getElementById('resend-link').addEventListener('click', async function(e) {
  e.preventDefault();
  const link = e.currentTarget;
  const msg = document.getElementById('resend-message');
  const emailToResend = email || prompt('Enter your email address to resend confirmation:');
  if (!emailToResend) return;

  // UI feedback
  link.textContent = 'Sendingâ€¦';
  link.classList.add('animate-pulse');
  link.setAttribute('aria-busy', 'true');

  // Fire-and-forget GET to GAS; we don't read response body
  const qs = new URLSearchParams({ action: 'resend_confirmation', email: emailToResend });
fetch('https://script.google.com/macros/s/AKfycbxiS7uDZ3tDEPsrys863zM-k9LN2aMBoa5WOCFhNgZogEgmnrJy_V-KaUxNATgHlzJsIw/exec?' + qs.toString(), {
  method: 'GET',
  mode: 'no-cors',
  keepalive: true
}).catch(() => {});


  // Local success UX
  if (msg) msg.classList.remove('hidden');
  link.textContent = 'Sent âœ”';
  link.classList.remove('animate-pulse');
  link.classList.add('pointer-events-none', 'text-gray-400');
  link.removeAttribute('href');
  link.setAttribute('aria-busy', 'false');
});

});

function updateThankYouContent() {
  if (segments.length === 0) {
    // No specific segments, keep default content
    return;
  }
  
  // Update the main message based on subscribed newsletters
  const mainMessage = document.querySelector('p.text-lg.text-gray-700.mb-6');
  const newsletterInfo = document.querySelector('.bg-blue-50.rounded-lg.p-6.mb-6');
  
  let newsletterNames = [];
  let stepDetails = [];
  
  // Build content based on segments
  segments.forEach(segment => {
    if (segment === 'pro') {
      newsletterNames.push('CoR Intelligence Weekly');
      stepDetails.push('Professional compliance intelligence for transport stakeholders');
    } else if (segment === 'driver') {
      newsletterNames.push('Safe Freight Mate');  
      stepDetails.push('Driver-focused safety communications and regulatory updates');
    }
  });
  
  if (newsletterNames.length > 0) {
    // Update main message
    const newsletterList = newsletterNames.length === 1 
      ? newsletterNames[0]
      : newsletterNames.slice(0, -1).join(', ') + ' and ' + newsletterNames.slice(-1);
      
    mainMessage.textContent = `We've sent ${newsletterNames.length === 1 ? 'a confirmation email' : 'confirmation emails'} to complete your subscription to ${newsletterList}.`;
    
    // Update the "What happens next" section
    const stepsList = newsletterInfo.querySelector('ol');
    if (stepsList) {
      stepsList.innerHTML = `
        <li class="flex items-center">
          <span class="bg-blue-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-semibold mr-3">1</span>
          Check your email and confirm ${newsletterNames.length === 1 ? 'your subscription' : 'each subscription'}
        </li>
        <li class="flex items-center">
          <span class="bg-blue-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-semibold mr-3">2</span>
          You'll receive ${newsletterList} every Friday
        </li>
        <li class="flex items-center">
          <span class="bg-blue-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-semibold mr-3">3</span>
          Stay informed with weekly compliance intelligence
        </li>
      `;
    }
    
    // Add newsletter details section
    const contentDiv = document.querySelector('.bg-white.rounded-lg.shadow-lg.p-8');
    const existingNewsletterInfo = document.querySelector('.newsletter-subscriptions');
    
    if (!existingNewsletterInfo && segments.length > 0) {
      const newsletterDetailsDiv = document.createElement('div');
      newsletterDetailsDiv.className = 'newsletter-subscriptions bg-gray-50 rounded-lg p-6 mb-6';
      
      let newsletterDetailsHTML = '<h3 class="text-lg font-semibold text-gray-800 mb-4">Your Newsletter Subscriptions:</h3>';
      
      segments.forEach(segment => {
        if (segment === 'pro') {
          newsletterDetailsHTML += `
            <div class="mb-4 p-4 bg-white rounded-lg border">
              <h4 class="font-semibold text-blue-800">ðŸ“Š CoR Intelligence Weekly</h4>
              <p class="text-sm text-gray-600">Professional compliance intelligence for transport stakeholders</p>
            </div>
          `;
        } else if (segment === 'driver') {
          newsletterDetailsHTML += `
            <div class="mb-4 p-4 bg-white rounded-lg border">
              <h4 class="font-semibold text-blue-800">ðŸš› Safe Freight Mate</h4>
              <p class="text-sm text-gray-600">Driver-focused safety communications and regulatory updates</p>
            </div>
          `;
        }
      });
      
      newsletterDetailsDiv.innerHTML = newsletterDetailsHTML;
      
      // Insert after the email check reminder
      const emailCheckDiv = document.querySelector('.bg-yellow-50.border.border-yellow-200');
      emailCheckDiv.parentNode.insertBefore(newsletterDetailsDiv, emailCheckDiv.nextSibling);
    }
  }
}
</script>
</body>
</html>
